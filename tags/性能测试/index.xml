<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>性能测试 on yanbo92.site</title><link>https://yanbo92.site/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/</link><description>Recent content in 性能测试 on yanbo92.site</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 06 Jan 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://yanbo92.site/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/index.xml" rel="self" type="application/rss+xml"/><item><title>腾讯性能狗收费之后，我写了一款iOS性能测试工具</title><link>https://yanbo92.site/ios-perf/</link><pubDate>Thu, 06 Jan 2022 00:00:00 +0000</pubDate><guid>https://yanbo92.site/ios-perf/</guid><description>&lt;img src="https://yanbo92.site/ios-perf/iOS-perf-1.png" alt="Featured image of post 腾讯性能狗收费之后，我写了一款iOS性能测试工具" />&lt;h2 id="运行效果">运行效果&lt;/h2>
&lt;p>&lt;img src="https://yanbo92.site/ios-perf/iOS-perf-1.png"
width="3426"
height="1990"
srcset="https://yanbo92.site/ios-perf/iOS-perf-1_huf985558f52f94ae7d6333bd201a6f5cc_710078_480x0_resize_box_3.png 480w, https://yanbo92.site/ios-perf/iOS-perf-1_huf985558f52f94ae7d6333bd201a6f5cc_710078_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ios-perf"
class="gallery-image"
data-flex-grow="172"
data-flex-basis="413px"
>&lt;/p>
&lt;h2 id="项目介绍">项目介绍&lt;/h2>
&lt;p>项目地址：&lt;a class="link" href="https://github.com/yanbo92/iOS-perf" target="_blank" rel="noopener"
>yanbo92/iOS-perf&lt;/a>&lt;/p>
&lt;p>性能测试一直是APP测试的一个重要部分，而在&lt;code>Android&lt;/code>上由于系统的开放特性，相关工具支持比较多，比如&lt;code>solopi&lt;/code>等。但在&lt;code>iOS&lt;/code>上，腾讯家的&lt;code>perfdog&lt;/code>本来还是十分好用的，但收费了就有点难受，而直接用&lt;code>Xcode&lt;/code>的&lt;code>Instruments&lt;/code>又对Mac有刚需，很难支撑公司的测试需求。此时看到&lt;a class="link" href="http://testerhome.com/topics/31066" target="_blank" rel="noopener"
>这个贴子&lt;/a>，上手跑了几次，还挺好用的，于是就顺着思路做了下去，有了这个比较完善的项目。&lt;/p>
&lt;p>当前支持获取的性能数据包括GPU、CPU、内存、FPS、功耗、网络、温度，以及一系列手机硬件数据，并将根据需求继续新增。&lt;/p>
&lt;p>本项目基于jlintxia开源的iOS测试方案修改而来，增加动态建表，动态增加grafana面板以及docker打包环境等特性。其中iOS性能数据来源于开源工具tidevice和py-ios-device。&lt;/p>
&lt;p>注意：本项目依赖MySQL进行性能数据存储，Grafana进行数据动态展示，也就是说需要在本机或者可达的网络（比如公司局域网） 上搭建MySQL+Grafana服务，我提供了一份docker-compose.yml文件，可以使用docker快速搭建一套环境。&lt;/p>
&lt;h2 id="相关工具">相关工具&lt;/h2>
&lt;h3 id="grafana">Grafana&lt;/h3>
&lt;p>&lt;a class="link" href="https://grafana.com/" target="_blank" rel="noopener"
>官网&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Grafana是一个跨平台、开源的数据可视化网络应用程序平台。用户配置连接的数据源之后，Grafana可以在网络浏览器里显示数据图表和警告。该软件的企业版本提供更多的扩展功能。扩展功能通过插件的形式提供，终端用户可以自定义自己的数据面板界面以及数据请求方式。&lt;/p>
&lt;/blockquote>
&lt;h3 id="mysql">MySQL&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.mysql.com/cn/" target="_blank" rel="noopener"
>官网&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>MySQL原本是一个开放源码的关系数据库管理系统，原开发者为瑞典的MySQL AB公司，该公司于2008年被昇阳微系统收购。2009年，甲骨文公司收购昇阳微系统公司，MySQL成为Oracle旗下产品。&lt;/p>
&lt;/blockquote>
&lt;h3 id="py-ios-device">py-ios-device&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/YueChen-C/py-ios-device" target="_blank" rel="noopener"
>项目地址&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>win，mac 跨平台方案，通过 Instruments 私有协议获取 iOS 相关性能指标数据。&lt;/p>
&lt;p>相关文章链接:https://testerhome.com/topics/27159&lt;/p>
&lt;/blockquote>
&lt;h3 id="tidevice">tidevice&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/alibaba/taobao-iphone-device" target="_blank" rel="noopener"
>项目地址&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>tidevice 是阿里的内部的一个小组用来做 iOS 自动化用的工具，通过逆向iOS通信协议，使用纯Python实现。目前淘宝和其他部分事业部已经全面使用了该技术，进行iOS应用的性能采集，UI自动化。&lt;/p>
&lt;p>注：这里的被测应用无需做任何修改，使用不再局限于Mac上。&lt;/p>
&lt;/blockquote>
&lt;h2 id="使用步骤">使用步骤&lt;/h2>
&lt;h3 id="准备工作">准备工作&lt;/h3>
&lt;p>服务端搭建依赖docker以及docker-compose，安装指南：&lt;/p>
&lt;blockquote>
&lt;p>&lt;a class="link" href="https://dockerdocs.cn/get-docker/" target="_blank" rel="noopener"
>https://dockerdocs.cn/get-docker/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://dockerdocs.cn/get-started/08_using_compose/" target="_blank" rel="noopener"
>https://dockerdocs.cn/get-started/08_using_compose/&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>运行测试依赖python3环境，安装指南：&lt;/p>
&lt;blockquote>
&lt;p>&lt;a class="link" href="https://www.python.org/downloads/" target="_blank" rel="noopener"
>https://www.python.org/downloads/&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h4 id="服务端搭建">服务端搭建&lt;/h4>
&lt;p>命令行运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker -v &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker-compose -v
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果能正常输出版本，如下，则表示docker环境正常，可以继续&lt;/p>
&lt;blockquote>
&lt;p>Docker version 20.10.8, build 3967b7d&lt;/p>
&lt;p>docker-compose version 1.29.2, build 5becea4c&lt;/p>
&lt;/blockquote>
&lt;p>拉取镜像并启动服务：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker-compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>提示：初次打开&lt;code>Grafana&lt;/code>时，系统会提示你修改密码，为了方便建议不修改，即保持账号密码均为&lt;code>admin&lt;/code>，否则在python运行指令中将要进行对应的传参。&lt;/strong>&lt;/p>
&lt;h4 id="本地环境搭建">本地环境搭建&lt;/h4>
&lt;p>命令行执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="运行命令">运行命令&lt;/h3>
&lt;p>命令行执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">python run.py --udid&lt;span class="o">=&lt;/span>00008110-001A4D483CF2801E &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--bundleid&lt;span class="o">=&lt;/span>com.apple.Preferences &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--grafana_host&lt;span class="o">=&lt;/span>localhost &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--grafana_port&lt;span class="o">=&lt;/span>&lt;span class="m">30000&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--grafana_user&lt;span class="o">=&lt;/span>admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--grafana_password&lt;span class="o">=&lt;/span>admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_host&lt;span class="o">=&lt;/span>localhost &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_port&lt;span class="o">=&lt;/span>&lt;span class="m">33306&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_username&lt;span class="o">=&lt;/span>root &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_password&lt;span class="o">=&lt;/span>admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_db&lt;span class="o">=&lt;/span>iOSPerformance
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="运行参数说明">运行参数说明&lt;/h4>
&lt;h5 id="建议修改参数">建议修改参数&lt;/h5>
&lt;blockquote>
&lt;ul>
&lt;li>&amp;ndash;bundleid：待测APP的包名，通过&lt;code>ideviceinstaller -l&lt;/code>获取，默认值为&lt;code>com.apple.Preferences&lt;/code>&lt;/li>
&lt;li>&amp;ndash;udid iPhone：手机的唯一标识符，通过 &lt;code>idevice_id -l&lt;/code> 获取，客户端只连接一台手机时不用写&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h5 id="grafana可选参数">Grafana可选参数&lt;/h5>
&lt;blockquote>
&lt;ul>
&lt;li>&amp;ndash;grafana_host：Grafana的主机地址，只写ip，不用写Scheme，也就是&lt;code>http://&lt;/code>或者&lt;code>https//&lt;/code>，默认值localhost&lt;/li>
&lt;li>&amp;ndash;grafana_port：Grafana的端口号，默认值30000&lt;/li>
&lt;li>&amp;ndash;grafana_user：Grafana的用户名，默认值admin&lt;/li>
&lt;li>&amp;ndash;grafana_password：Grafana的密码，默认值admin&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h5 id="mysql可选参数">MySQL可选参数&lt;/h5>
&lt;blockquote>
&lt;ul>
&lt;li>&amp;ndash;mysql_host：MySQL的主机地址，不用写Scheme，也就是&lt;code>http://&lt;/code>或者&lt;code>https//&lt;/code>，默认值localhost&lt;/li>
&lt;li>&amp;ndash;mysql_port：MySQL的端口号，默认值33306&lt;/li>
&lt;li>&amp;ndash;mysql_user：MySQL的用户名，默认值root&lt;/li>
&lt;li>&amp;ndash;mysql_password：MySQL的用户名，默认值admin&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="数据导出">数据导出&lt;/h3>
&lt;p>命令行执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">python mysql.py --runid&lt;span class="o">=&lt;/span>iphone6_1008_1532 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_host&lt;span class="o">=&lt;/span>localhost &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_port&lt;span class="o">=&lt;/span>&lt;span class="m">33306&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_username&lt;span class="o">=&lt;/span>root &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_password&lt;span class="o">=&lt;/span>admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--mysql_db&lt;span class="o">=&lt;/span>iOSPerformance
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中，&lt;code>--runid&lt;/code>为必须参数，可以从显示测试数据的Grafana页面的左上角找到，通常为手机名称+月日+时分。其余Mysql参数均为可选参数，默认值与上方&lt;a class="link" href="#MySQL%e5%8f%af%e9%80%89%e5%8f%82%e6%95%b0" >MySQL可选参数&lt;/a>相同。&lt;/p>
&lt;h2 id="心得">心得&lt;/h2>
&lt;p>Docker起服务实在是太方便了，grafana做可视化也很香。也很感慨现在测试开发方面的开源环境发展起来了，有很多现成的代码可以参考。&lt;/p>
&lt;h2 id="参考文章">参考文章&lt;/h2>
&lt;p>&lt;a class="link" href="https://perfdog.qq.com/" target="_blank" rel="noopener"
>PerfDog | 移动全平台性能测试分析专家&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://testerhome.com/topics/27159" target="_blank" rel="noopener"
>硬货来啦！！使用纯 python 实现 Instruments 协议，跨平台 (win,mac,linux) 获取 iOS 性能数据 · TesterHome&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://tech.taobao.org/news/lxhg5l" target="_blank" rel="noopener"
>新工具开源！一款iOS自动化利器（附地址）&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://testerhome.com/topics/31066" target="_blank" rel="noopener"
>实时可视化 iOS 性能数据 tidevice+pyiosdevice+mysql+grafana · TesterHome&lt;/a>&lt;/p></description></item></channel></rss>