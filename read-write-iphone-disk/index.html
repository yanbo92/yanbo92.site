<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>通过ifuse/tidevice库读写iPhone手机硬盘 | 茅测顿开</title><meta name=keywords content="iOS,libimobiledevice,ifuse,tidevice,osxfuse,macfuse,python"><meta name=description content="背景 在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是ifuse和tidevice。
工具介绍 MacFuse  What is macFUSE? macFUSE allows you to extend macOS&rsquo;s native file handling capabilities via third-party file systems.
macFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。
Features As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.
As a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs."><meta name=author content="yanbo92"><link rel=canonical href=https://yanbo92.github.io/read-write-iphone-disk/><link href=/assets/css/stylesheet.min.746a86b58bb2b052b5e4df8216510494f04f81e62c08d626150c26c69ca929da.css integrity="sha256-dGqGtYuysFK15N+CFlEElPBPgeYsCNYmFQwmxpypKdo=" rel="preload stylesheet" as=style><link rel=icon href=https://yanbo92.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yanbo92.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yanbo92.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://yanbo92.github.io/apple-touch-icon.png><link rel=mask-icon href=https://yanbo92.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.94.2"><meta property="og:title" content="通过ifuse/tidevice库读写iPhone手机硬盘"><meta property="og:description" content="背景 在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是ifuse和tidevice。
工具介绍 MacFuse  What is macFUSE? macFUSE allows you to extend macOS&rsquo;s native file handling capabilities via third-party file systems.
macFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。
Features As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.
As a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs."><meta property="og:type" content="article"><meta property="og:url" content="https://yanbo92.github.io/read-write-iphone-disk/"><meta property="og:image" content="https://yanbo92.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="og:site_name" content="茅测顿开"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yanbo92.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="通过ifuse/tidevice库读写iPhone手机硬盘"><meta name=twitter:description content="背景 在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是ifuse和tidevice。
工具介绍 MacFuse  What is macFUSE? macFUSE allows you to extend macOS&rsquo;s native file handling capabilities via third-party file systems.
macFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。
Features As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.
As a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yanbo92.github.io/posts/"},{"@type":"ListItem","position":2,"name":"通过ifuse/tidevice库读写iPhone手机硬盘","item":"https://yanbo92.github.io/read-write-iphone-disk/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"通过ifuse/tidevice库读写iPhone手机硬盘","name":"通过ifuse\/tidevice库读写iPhone手机硬盘","description":"背景 在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是ifuse和tidevice。\n工具介绍 MacFuse  What is macFUSE? macFUSE allows you to extend macOS\u0026rsquo;s native file handling capabilities via third-party file systems.\nmacFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。\nFeatures As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.\nAs a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs.","keywords":["iOS","libimobiledevice","ifuse","tidevice","osxfuse","macfuse","python"],"articleBody":"背景 在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是ifuse和tidevice。\n工具介绍 MacFuse  What is macFUSE? macFUSE allows you to extend macOS’s native file handling capabilities via third-party file systems.\nmacFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。\nFeatures As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.\nAs a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs. The content of these file systems can come from anywhere: from the local disk, from across the network, from memory, or any other combination of sources. Writing a file system using FUSE is orders of magnitude easier and quicker than the traditional approach of writing in-kernel file systems. Since FUSE file systems are regular applications (as opposed to kernel extensions), you have just as much flexibility and choice in programming tools, debuggers, and libraries as you have if you were developing standard macOS applications.\n作为一个用户，安装macFUSE软件包可以让你使用任何第三方FUSE文件系统。传统的MacFUSE文件系统通过可选的MacFUSE兼容层得到支持。\n作为开发者，你可以使用 FUSE SDK 来编写众多类型的新文件系统，作为常规的用户空间程序。这些文件系统的内容可以来自任何地方：来自本地磁盘，来自整个网络，来自内存，或任何其他来源的组合。使用FUSE编写文件系统比编写内核内文件系统的传统方法要容易得多，也快得多。由于 FUSE 文件系统是普通的应用程序（而不是内核扩展），你在编程工具、调试器和库方面的灵活性和选择与开发标准的 macOS 应用程序一样多。\n项目主页：osxfuse.github.io\n安装：\nbrew install osxfuse --cask  ifuse  A fuse filesystem implementation to access the contents of iOS devices.\n一个Fuse文件系统的实现，用于访问iOS设备的内容。\nFeatures This project allows mounting various directories of an iOS device locally using the FUSE file system interface.\n这个项目允许使用[FUSE文件系统接口]在本地挂载iOS设备的各种目录。\nSome key features are:\n Media: Mount media directory of an iOS device locally Apps: Mount sandbox container or document directory of an app Jailbreak: Mount root filesystem on jailbroken devices (requires AFC2 service) Browse: Allows to retrieve a list of installed file-sharing enabled apps Implementation: Uses libimobiledevice for communication with the device  主要特性如下\n 媒体。在本地安装iOS设备的媒体目录 Apps。挂载一个应用程序的沙盒容器或文档目录。 越狱。在已越狱的设备上挂载根文件系统 （需要AFC2服务）。 浏览。允许检索已安装的支持文件共享的应用程序的列表 实施。使用[libimobiledevice]与设备进行通信  项目主页：\n安装：\nbrew install ifuse 如果装不上，把系统时间改到2021年4月6日之前即可。但时间改了之后又会出现443:\ncurl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to ghcr.io:443 所以正确的操作流程是要在通过了brew校验这个包可以装之后再改回正常的时间，以通过下载包所需要的SSL校验，毫秒级操作，不过多试几次就能装上去。\n此项目依赖osxfuse，请先安装上面的osxfuse。\n tidevice  该工具能够用于与iOS设备进行通信, 提供以下功能\n 截图 获取手机信息 ipa包的安装和卸载 根据bundleID 启动和停止应用 列出安装应用信息 模拟Xcode运行XCTest，常用的如启动WebDriverAgent测试（此方法不依赖xcodebuild) 获取指定应用性能(CPU,MEM,FPS) 文件操作 其他  支持运行在Mac，Linux，Windows上\n项目主页：alibaba/taobao-iphone-device\n安装：\npip3 install -U \"tidevice[openssl]\"  实现原理  通过阅读源码可以得知，ifuse依赖libimobiledevice，同时是基于usbmux实现的，换言之，该库只支持通过电脑usb连接手机来通信。ifuse将手机硬盘的某一部分挂载到电脑硬盘上，再通过正常的文件读写操作去控制。 而tidevice则是把instruments协议整个用python实现了一遍，这是支持无线连接手机的。并且开发者将常用文件操作封装了一层，支持 rm cat pull push stat tree rmtree mkdir ls 等操作，有点adb的味道。  具体实现代码 ifuse读写手机内存 首先新建一个mount_point目录用于挂载手机硬盘：\nmkdir mount_point 然后用默认参数挂载，这样将会挂载整个Media目录，可以拿到DCIM以及Downloads之类的目录内容：\nMacBook-Pro ~ % ifuse -u c6b0ab4fa8867c51cf1c5b6d8cd076d3957192b2 mount_point MacBook-Pro ~ % ls mount_point AirFair\tMediaAnalysis\tPurchases\tafk(1).zip\trd Books\tPhotoData\tRadio\tafk_screenshots DCIM\tPhotos\tRecordings\tgeneral_storage Downloads\tPublicStaging\tafk\tiTunes_Control 可以像自己电脑上的目录一样去读写，比如rm，mkdir之类的都没问题。\n卸载掉：\numount mount_point 还有另一种更强力的卸载，毕竟这个库经常会卸载不掉：\ndiskutil unmount force mount_point 再试试指定APP包名的挂载方式，此处用的是Alook浏览器com.ld.TakeBrowser：\nMacBook-Pro ~ % ifuse --documents com.ld.TakeBrowser -u c6b0ab4fa8867c51cf1c5b6d8cd076d3957192b2 mount_point MacBook-Pro ~ % ls mount_point Audios\tImages\tVideos Documents\tOthers\tZipped 这里挂载了APP的Documents目录，同样可以使用的参数还有--container\ntidevice读写手机内存 首先新建一个txt用于调试\ntouch file.txt 类似的，查看Media下的目录：\nMacBook-Pro ~ % tidevice fsync ls /DCIM/ ['.DS_Store', '104APPLE', '._.DS_Store', '103APPLE', '102APPLE', '.MISC', '101APPLE', '100APPLE'] 删除一张照片：\nMacBook-Pro ~ % tidevice fsync rm /DCIM/104APPLE/IMG_4334.JPG 操作特定的APP目录，需要使用-B参数：\nls操作：\nMacBook-Pro ~ % tidevice fsync -B com.ld.TakeBrowser ls /Documents ['Zipped', 'Documents', 'Videos', 'Others', 'Images', 'Audios'] push操作：\nMacBook-Pro ~ % tidevice fsync -B com.ld.TakeBrowser push file.txt /Documents/ pushed to /Documents/ 类似的支持的操作还有如下几个：\n{rm,cat,pull,stat,tree,rmtree,mkdir 使用建议 个人认为在功能没有差异的情况下，使用tidevice要比ifuse方便得多，有如下原因\n 基于Python实现，相对于ifuse使用C的实现更适合脚本集成，可以直接用python的import使用，无需使用类似os.system()这种粗暴的方式 tidevice无需挂载到本机，实际使用起来ifuse经常出现某个目录卸载失败，需要重启电脑这样的情况，会出现Input/Output Error，也就是规避掉了关闭通道异常这种风险 tidevice基于instruments实现，支持无线连接手机，当你的测试手机USB口被占用时，tidevice是唯一的选择。  ","wordCount":"449","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"yanbo92"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yanbo92.github.io/read-write-iphone-disk/"},"publisher":{"@type":"Organization","name":"茅测顿开","logo":{"@type":"ImageObject","url":"https://yanbo92.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://yanbo92.github.io/ accesskey=h title="首页 (Alt + H)">首页</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://yanbo92.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://yanbo92.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://yanbo92.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://github.com/yanbo92 title=Github><span>Github</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yanbo92.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://yanbo92.github.io/posts/>Posts</a></div><h1 class=post-title>通过ifuse/tidevice库读写iPhone手机硬盘</h1><div class=post-meta>yanbo92
|&nbsp;<a href=https://github.com/yanbo92/yanbo92.github.io/tree/master/content/posts/read-write-iphone-disk/index.md rel="noopener noreferrer" target=_blank>修改建议</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>目录</div></summary><div class=inner><ul><li><a href=#%e8%83%8c%e6%99%af aria-label=背景>背景</a></li><li><a href=#%e5%b7%a5%e5%85%b7%e4%bb%8b%e7%bb%8d aria-label=工具介绍>工具介绍</a><ul><ul><li><a href=#macfuse aria-label=MacFuse>MacFuse</a></li></ul></ul></li><li><a href=#what-is-macfuse aria-label="What is macFUSE?">What is macFUSE?</a><ul><li><a href=#features aria-label=Features>Features</a><ul><li><a href=#ifuse aria-label=ifuse>ifuse</a></li></ul></li></ul></li><li><a href=#features-1 aria-label=Features>Features</a><ul><ul><li><a href=#tidevice aria-label=tidevice>tidevice</a></li></ul></ul></li><li><a href=#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86 aria-label=实现原理>实现原理</a></li><li><a href=#%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0%e4%bb%a3%e7%a0%81 aria-label=具体实现代码>具体实现代码</a><ul><ul><li><a href=#ifuse%e8%af%bb%e5%86%99%e6%89%8b%e6%9c%ba%e5%86%85%e5%ad%98 aria-label=ifuse读写手机内存>ifuse读写手机内存</a></li><li><a href=#tidevice%e8%af%bb%e5%86%99%e6%89%8b%e6%9c%ba%e5%86%85%e5%ad%98 aria-label=tidevice读写手机内存>tidevice读写手机内存</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%bb%ba%e8%ae%ae aria-label=使用建议>使用建议</a></li></ul></ul></li></ul></div></details></div><div class=post-content><h2 id=背景>背景<a hidden class=anchor aria-hidden=true href=#背景>#</a></h2><p>在自动化测试的交付、执行过程中，偶尔需要对iPhone手机的硬盘进行读写操作，比如删除相册，拷贝素材等等。本文介绍两个通过命令行操作iPhone手机硬盘的工具，分别是<code>ifuse</code>和<code>tidevice</code>。</p><h2 id=工具介绍>工具介绍<a hidden class=anchor aria-hidden=true href=#工具介绍>#</a></h2><h4 id=macfuse>MacFuse<a hidden class=anchor aria-hidden=true href=#macfuse>#</a></h4><blockquote><h2 id=what-is-macfuse>What is macFUSE?<a hidden class=anchor aria-hidden=true href=#what-is-macfuse>#</a></h2><p>macFUSE allows you to extend macOS&rsquo;s native file handling capabilities via third-party file systems.</p><p>macFUSE允许你通过第三方文件系统扩展macOS的本地文件处理能力。</p><h3 id=features>Features<a hidden class=anchor aria-hidden=true href=#features>#</a></h3><p>As a user, installing the macFUSE software package will let you use any third-party FUSE file system. Legacy MacFUSE file systems are supported through the optional MacFUSE compatibility layer.</p><p>As a developer, you can use the FUSE SDK to write numerous types of new file systems as regular user space programs. The content of these file systems can come from anywhere: from the local disk, from across the network, from memory, or any other combination of sources. Writing a file system using FUSE is orders of magnitude easier and quicker than the traditional approach of writing in-kernel file systems. Since FUSE file systems are regular applications (as opposed to kernel extensions), you have just as much flexibility and choice in programming tools, debuggers, and libraries as you have if you were developing standard macOS applications.</p><p>作为一个用户，安装macFUSE软件包可以让你使用任何第三方FUSE文件系统。传统的MacFUSE文件系统通过可选的MacFUSE兼容层得到支持。</p><p>作为开发者，你可以使用 FUSE SDK 来编写众多类型的新文件系统，作为常规的用户空间程序。这些文件系统的内容可以来自任何地方：来自本地磁盘，来自整个网络，来自内存，或任何其他来源的组合。使用FUSE编写文件系统比编写内核内文件系统的传统方法要容易得多，也快得多。由于 FUSE 文件系统是普通的应用程序（而不是内核扩展），你在编程工具、调试器和库方面的灵活性和选择与开发标准的 macOS 应用程序一样多。</p><p>项目主页：<a href=https://osxfuse.github.io/>osxfuse.github.io</a></p><p>安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>brew install osxfuse --cask
</span></span></code></pre></div></blockquote><h4 id=ifuse>ifuse<a hidden class=anchor aria-hidden=true href=#ifuse>#</a></h4><blockquote><p><em>A fuse filesystem implementation to access the contents of iOS devices.</em></p><p>一个Fuse文件系统的实现，用于访问iOS设备的内容。</p><h2 id=features-1>Features<a hidden class=anchor aria-hidden=true href=#features-1>#</a></h2><p>This project allows mounting various directories of an iOS device locally using the <a href=https://github.com/libfuse/libfuse>FUSE file system interface</a>.</p><p>这个项目允许使用[FUSE文件系统接口]在本地挂载iOS设备的各种目录。</p><p>Some key features are:</p><ul><li><strong>Media</strong>: Mount media directory of an iOS device locally</li><li><strong>Apps</strong>: Mount sandbox container or document directory of an app</li><li><strong>Jailbreak</strong>: Mount root filesystem on jailbroken devices <em>(requires AFC2 service)</em></li><li><strong>Browse</strong>: Allows to retrieve a list of installed file-sharing enabled apps</li><li><strong>Implementation</strong>: Uses <a href=https://github.com/libimobiledevice/libimobiledevice>libimobiledevice</a> for communication with the device</li></ul><p>主要特性如下</p><ul><li><strong>媒体</strong>。在本地安装iOS设备的媒体目录</li><li><strong>Apps</strong>。挂载一个应用程序的沙盒容器或文档目录。</li><li><strong>越狱</strong>。在已越狱的设备上挂载根文件系统 <em>（需要AFC2服务）</em>。</li><li><strong>浏览</strong>。允许检索已安装的支持文件共享的应用程序的列表</li><li><strong>实施</strong>。使用[libimobiledevice]与设备进行通信</li></ul><p>项目主页：</p><p>安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>brew install ifuse
</span></span></code></pre></div><p>如果装不上，把系统时间改到2021年4月6日之前即可。但时间改了之后又会出现443:</p><pre tabindex=0><code>curl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to ghcr.io:443 
</code></pre><p>所以正确的操作流程是要在通过了brew校验这个包可以装之后再改回正常的时间，以通过下载包所需要的SSL校验，毫秒级操作，不过多试几次就能装上去。</p><p>此项目依赖osxfuse，请先安装上面的osxfuse。</p></blockquote><h4 id=tidevice>tidevice<a hidden class=anchor aria-hidden=true href=#tidevice>#</a></h4><blockquote><p>该工具能够用于与iOS设备进行通信, 提供以下功能</p><ul><li>截图</li><li>获取手机信息</li><li>ipa包的安装和卸载</li><li>根据bundleID 启动和停止应用</li><li>列出安装应用信息</li><li>模拟Xcode运行XCTest，常用的如启动WebDriverAgent测试（此方法不依赖xcodebuild)</li><li>获取指定应用性能(CPU,MEM,FPS)</li><li>文件操作</li><li>其他</li></ul><p>支持运行在Mac，Linux，Windows上</p><p>项目主页：<a href=https://github.com/alibaba/taobao-iphone-device>alibaba/taobao-iphone-device</a></p><p>安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pip3 install -U <span class=s2>&#34;tidevice[openssl]&#34;</span>
</span></span></code></pre></div></blockquote><h2 id=实现原理>实现原理<a hidden class=anchor aria-hidden=true href=#实现原理>#</a></h2><ul><li>通过阅读源码可以得知，<code>ifuse</code>依赖<code>libimobiledevice</code>，同时是基于<code>usbmux</code>实现的，换言之，该库只支持通过电脑usb连接手机来通信。ifuse将手机硬盘的某一部分挂载到电脑硬盘上，再通过正常的文件读写操作去控制。</li><li>而<code>tidevice</code>则是把<code>instruments</code>协议整个用python实现了一遍，这是支持<strong>无线</strong>连接手机的。并且开发者将常用文件操作封装了一层，支持<code> rm cat pull push stat tree rmtree mkdir ls</code> 等操作，有点adb的味道。</li></ul><h2 id=具体实现代码>具体实现代码<a hidden class=anchor aria-hidden=true href=#具体实现代码>#</a></h2><h4 id=ifuse读写手机内存>ifuse读写手机内存<a hidden class=anchor aria-hidden=true href=#ifuse读写手机内存>#</a></h4><p>首先新建一个mount_point目录用于挂载手机硬盘：</p><pre tabindex=0><code>mkdir mount_point
</code></pre><p>然后用默认参数挂载，这样将会挂载整个<code>Media</code>目录，可以拿到<code>DCIM</code>以及<code>Downloads</code>之类的目录内容：</p><pre tabindex=0><code>MacBook-Pro ~ % ifuse -u c6b0ab4fa8867c51cf1c5b6d8cd076d3957192b2 mount_point
MacBook-Pro ~ % ls mount_point
AirFair		MediaAnalysis	Purchases	afk(1).zip	rd
Books		PhotoData	Radio		afk_screenshots
DCIM		Photos		Recordings	general_storage
Downloads	PublicStaging	afk		iTunes_Control
</code></pre><p>可以像自己电脑上的目录一样去读写，比如<code>rm</code>，<code>mkdir</code>之类的都没问题。</p><p>卸载掉：</p><pre tabindex=0><code>umount mount_point
</code></pre><p>还有另一种更强力的卸载，毕竟这个库经常会卸载不掉：</p><pre tabindex=0><code>diskutil unmount force mount_point
</code></pre><p>再试试指定APP包名的挂载方式，此处用的是Alook浏览器<code>com.ld.TakeBrowser</code>：</p><pre tabindex=0><code>MacBook-Pro ~ % ifuse --documents com.ld.TakeBrowser -u c6b0ab4fa8867c51cf1c5b6d8cd076d3957192b2 mount_point
MacBook-Pro ~ % ls mount_point
Audios		Images		Videos
Documents	Others		Zipped
</code></pre><p>这里挂载了APP的Documents目录，同样可以使用的参数还有<code>--container</code></p><h4 id=tidevice读写手机内存>tidevice读写手机内存<a hidden class=anchor aria-hidden=true href=#tidevice读写手机内存>#</a></h4><p>首先新建一个txt用于调试</p><pre tabindex=0><code>touch file.txt
</code></pre><p>类似的，查看<code>Media</code>下的目录：</p><pre tabindex=0><code>MacBook-Pro ~ % tidevice fsync ls /DCIM/
[&#39;.DS_Store&#39;,
 &#39;104APPLE&#39;,
 &#39;._.DS_Store&#39;,
 &#39;103APPLE&#39;,
 &#39;102APPLE&#39;,
 &#39;.MISC&#39;,
 &#39;101APPLE&#39;,
 &#39;100APPLE&#39;]
</code></pre><p>删除一张照片：</p><pre tabindex=0><code>MacBook-Pro ~ % tidevice fsync rm /DCIM/104APPLE/IMG_4334.JPG
&lt;AFCStatus.SUCCESS: 0&gt;
</code></pre><p>操作特定的APP目录，需要使用<code>-B</code>参数：</p><p>ls操作：</p><pre tabindex=0><code>MacBook-Pro ~ % tidevice fsync -B com.ld.TakeBrowser ls /Documents
[&#39;Zipped&#39;, &#39;Documents&#39;, &#39;Videos&#39;, &#39;Others&#39;, &#39;Images&#39;, &#39;Audios&#39;]
</code></pre><p>push操作：</p><pre tabindex=0><code>MacBook-Pro ~ % tidevice fsync -B com.ld.TakeBrowser push file.txt /Documents/
pushed to /Documents/
</code></pre><p>类似的支持的操作还有如下几个：</p><pre tabindex=0><code>{rm,cat,pull,stat,tree,rmtree,mkdir
</code></pre><h4 id=使用建议>使用建议<a hidden class=anchor aria-hidden=true href=#使用建议>#</a></h4><p>个人认为在功能没有差异的情况下，使用<code>tidevice</code>要比<code>ifuse</code>方便得多，有如下原因</p><ul><li>基于Python实现，相对于ifuse使用C的实现更适合脚本集成，可以直接用python的<code>import</code>使用，无需使用类似<code>os.system()</code>这种粗暴的方式</li><li><code>tidevice</code>无需挂载到本机，实际使用起来<code>ifuse</code>经常出现某个目录卸载失败，需要重启电脑这样的情况，会出现<code>Input/Output Error</code>，也就是规避掉了关闭通道异常这种风险</li><li><code>tidevice</code>基于<code>instruments</code>实现，支持无线连接手机，当你的测试手机USB口被占用时，<code>tidevice</code>是唯一的选择。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://yanbo92.github.io/tags/ios/>iOS</a></li><li><a href=https://yanbo92.github.io/tags/libimobiledevice/>libimobiledevice</a></li><li><a href=https://yanbo92.github.io/tags/ifuse/>ifuse</a></li><li><a href=https://yanbo92.github.io/tags/tidevice/>tidevice</a></li><li><a href=https://yanbo92.github.io/tags/osxfuse/>osxfuse</a></li><li><a href=https://yanbo92.github.io/tags/macfuse/>macfuse</a></li><li><a href=https://yanbo92.github.io/tags/python/>python</a></li></ul><nav class=paginav><a class=prev href=https://yanbo92.github.io/jenkins-extended-choice-parameter-2/><span class=title>« 上一页</span><br><span>通过Extended-Choice-Parameter插件将Jenkins参数选项动态设置为当前连接的iOS/Android手机(二)</span></a>
<a class=next href=https://yanbo92.github.io/halo-ipa/><span class=title>下一页 »</span><br><span>重签名解决光环助手频繁掉签问题</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://yanbo92.github.io/>茅测顿开</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>